
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>04.02 - DATA CLEANING &#8212; Inteligencia Artificial para las Ciencias e Ingenierías</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.37f24b989f4638ff9c27c22dc7559d4f.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="04.03 - HYPOTHESIS TESTING" href="NOTES%2004.03%20-%20SIMPLE%20HYPOTHESIS%20TESTING.html" />
    <link rel="prev" title="04.01 - DATA EXPLORATION" href="NOTES%2004.01%20-%20DATA%20EXPLORATION.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/fudea.jpg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Inteligencia Artificial para las Ciencias e Ingenierías</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Información del curso
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="M01_videos.html">
   MODULO 1: Introducción
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2001.01%20-%20PRACTICE%20SUBMISSION.html">
     LAB 01.01 - Practice submission
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2001.02%20-%20METRICS.html">
     LAB 01.02 - Metrics
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="M02_videos.html">
   MODULO 2: Python
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2002.01%20-%20PYTHON%20BASIC%20STRUCTURES.html">
     02.01 - BASIC STRUCTURES
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2002.02%20-%20MORE%20PYTHON.html">
     02.02 - MORE PYTHON
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2002.03%20-%20PYTHON%20NUMPY.html">
     02.03 - NUMPY
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2002.04%20-%20PANDAS.html">
     02.04 - PANDAS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2002.01%20-%20PYTHON.html">
     LAB 02.01 - Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2002.02%20-%20NUMPY.html">
     LAB 02.02 - Numpy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2002.03%20-%20PANDAS.html">
     LAB 02.03 - Pandas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2002.04%20-%20CARD%20TRICK.html">
     LAB 02.04 - Card trick
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="M03_videos.html">
   MODULO 3: Generación de modelos
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2003.01%20-%20MODELS%20DERIVED%20FROM%20DATA.html">
     03.01 - MODELS FROM DATA
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2003.02%20-%20SUPERVISED%20ALGORITHMS.html">
     03.02 - SUPERVISED ALGORITHMS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2003.03%20-%20SVM%20AND%20FEATURE%20TRANSFORMATION.html">
     03.03 - SVMs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2003.01%20-%20MODEL%20GENERATION.html">
     LAB 03.01 - Model Generation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2003.02%20-%20TIMESERIES%20MODEL.html">
     LAB 03.02 - Timeseries model
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="M04_videos.html">
   MODULO 4: Gestión de datos
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2004.01%20-%20DATA%20EXPLORATION.html">
     04.01 - DATA EXPLORATION
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     04.02 - DATA CLEANING
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2004.03%20-%20SIMPLE%20HYPOTHESIS%20TESTING.html">
     04.03 - HYPOTHESIS TESTING
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2004.04%20-%20HYPOTHESIS%20TESTING%20-%20COMPARING%20SAMPLE%20MEANS.html">
     04.04 - COMPARING SAMPLES
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2004.01%20-%20CLEANING%20DATA.html">
     LAB 04.01 - Cleaning Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2004.02%20-%20BUILDING%20DATASETS.html">
     LAB 04.02 - Buiding Datasets
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="M05_videos.html">
   MODULO 5: Gestión de modelos
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2005.01%20-%20A%20TIME%20SERIES%20PREDICTIVE%20STRATEGY.html">
     05.01 - TIME SERIES PREDICTIONS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2005.02%20-%20MODEL%20EVALUATION.html">
     05.02 - MODEL EVALUATION
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2005.03%20-%20MODEL%20SELECTION.html">
     05.03 - MODEL SELECTION
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2005.04%20-%20EXAMPLE%20SUBMISSION%20TO%20KAGGLE.html">
     05.04 - PARTICIPATE IN KAGGLE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2005.01%20-%20MEASURING%20PREDICTIVITY%20IMPACT.html">
     LAB 05.01 - Predictions impact
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2005.02%20-%20MODEL%20EVALUATION.html">
     LAB 05.02 - Model evaluation
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="M06_videos.html">
   MODULO 6: Métodos no supervisados
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2006.01%20-%20UNSUPERVISED%20LEARNING%20-%20CLUSTERING.html">
     06.01 - CLUSTERING
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2006.02%20-%20PCA.html">
     06.02 - PCA
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2006.03%20-%20DIMENSIONALITY%20REDUCTION.html">
     06.03 - PCA, NMF IN PRACTICE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2006.01%20-%20CLUSTERING.html">
     LAB 06.01 - Clustering companies
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2006.02%20-%20NMF%20face%20search.html">
     LAB 06.02 - NMF face search
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="M07_videos.html">
   MODULO 7: Diseño de algoritmos
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2007.01%20-%20OPTIMIZATION.html">
     07.01 - OPTIMIZATION
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2007.02%20-%20DESIGNING%20ML%20ALGORITHMS.html">
     07.02 - DESIGN ML ALGORITHMS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2007.03%20-%20NEURAL%20NETWORKS.html">
     07.03 - NEURAL NETWORKS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NOTES%2007.04%20-%20NEURAL%20NETWORKS%20WITH%20TENSORFLOW.html">
     07.04 - TENSORFLOW
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2007.01%20-%20OPTIMIZATION%20FOR%20ML.html">
     LAB 07.01 - Optimization for ML
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LAB%2007.02%20-%20NEURAL%20NETWORKS.html">
     LAB 07.02 - Neural networks
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/content/NOTES 04.02 - DATA CLEANING.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/rramosp/ai4eng.v1/blob/main/content/NOTES 04.02 - DATA CLEANING.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#based-on-kaggle-house-pricing-prediction-competition">
   Based on Kaggle House Pricing Prediction Competition
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#we-must-repair-the-missing-data-in-the-following-columns">
   We must repair the missing data in the following columns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inspect-and-understand-missing-data">
     Inspect and understand missing data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#common-sense">
     common sense
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#for-continuous-variables">
   For continuous variables
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#three-substitution-techniques">
     Three substitution techniques
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validation-workflow-for-repairing-missing-values-on-lotfrontage">
     Validation workflow for repairing missing values on
     <strong>
      LotFrontage
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#for-categorical-features">
   For categorical features
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="data-cleaning">
<h1>04.02 - DATA CLEANING<a class="headerlink" href="#data-cleaning" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>wget --no-cache -O init.py -q https://raw.githubusercontent.com/rramosp/ai4eng.v1/main/content/init.py
<span class="kn">import</span> <span class="nn">init</span><span class="p">;</span> <span class="n">init</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">force_download</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span> <span class="n">init</span><span class="o">.</span><span class="n">get_weblink</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="based-on-kaggle-house-pricing-prediction-competition">
<h2>Based on <a class="reference external" href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques/">Kaggle House Pricing Prediction Competition</a><a class="headerlink" href="#based-on-kaggle-house-pricing-prediction-competition" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Inspect and learn from the competition <a class="reference external" href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques/notebooks">Notebooks</a></p></li>
<li><p>You must make available to this notebook the <code class="docutils literal notranslate"><span class="pre">train.csv</span></code> file from the competition <a class="reference external" href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques/data">data</a> section. If running this notebook in Google Colab you must upload it in the notebook files section in Colab.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">progressbar</span> <span class="kn">import</span> <span class="n">progressbar</span> <span class="k">as</span> <span class="n">pbar</span>
<span class="kn">from</span> <span class="nn">local.lib</span> <span class="kn">import</span> <span class="n">mlutils</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;train.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;Id&quot;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>LotConfig</th>
      <th>...</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
      <th>SalePrice</th>
    </tr>
    <tr>
      <th>Id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>60</td>
      <td>RL</td>
      <td>65.0</td>
      <td>8450</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>Reg</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Inside</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>2</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>208500</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
      <td>RL</td>
      <td>80.0</td>
      <td>9600</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>Reg</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>FR2</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2007</td>
      <td>WD</td>
      <td>Normal</td>
      <td>181500</td>
    </tr>
    <tr>
      <th>3</th>
      <td>60</td>
      <td>RL</td>
      <td>68.0</td>
      <td>11250</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Inside</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>9</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>223500</td>
    </tr>
    <tr>
      <th>4</th>
      <td>70</td>
      <td>RL</td>
      <td>60.0</td>
      <td>9550</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Corner</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>2</td>
      <td>2006</td>
      <td>WD</td>
      <td>Abnorml</td>
      <td>140000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>60</td>
      <td>RL</td>
      <td>84.0</td>
      <td>14260</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>FR2</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>12</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>250000</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 80 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1460, 80)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="we-must-repair-the-missing-data-in-the-following-columns">
<h2>We must repair the missing data in the following columns<a class="headerlink" href="#we-must-repair-the-missing-data-in-the-following-columns" title="Permalink to this headline">¶</a></h2>
<p><strong>Possible repair actions</strong>:</p>
<ul class="simple">
<li><p>Remove row or column</p></li>
<li><p>Replace value (why what?)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">k</span><span class="p">[</span><span class="n">k</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LotFrontage      259
Alley           1369
MasVnrType         8
MasVnrArea         8
BsmtQual          37
BsmtCond          37
BsmtExposure      38
BsmtFinType1      37
BsmtFinType2      38
Electrical         1
FireplaceQu      690
GarageType        81
GarageYrBlt       81
GarageFinish      81
GarageQual        81
GarageCond        81
PoolQC          1453
Fence           1179
MiscFeature     1406
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="section" id="inspect-and-understand-missing-data">
<h3>Inspect and understand missing data<a class="headerlink" href="#inspect-and-understand-missing-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="k">def</span> <span class="nf">plot_missing</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">f1</span><span class="p">():</span> 
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">==</span><span class="nb">object</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;missing&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;distribution of </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="k">col</span>)
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">f2</span><span class="p">():</span> 
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">==</span><span class="nb">object</span><span class="p">:</span>
            <span class="n">k</span><span class="o">=</span><span class="n">d</span><span class="p">[[</span><span class="n">col</span><span class="p">,</span><span class="n">target</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">==</span><span class="n">v</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="n">k</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">==</span><span class="n">v</span><span class="p">],</span> 
                                 <span class="n">hist_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">),</span> 
                                 <span class="n">kde_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">8</span><span class="p">),</span>
                                 <span class="n">label</span><span class="o">=</span><span class="n">v</span><span class="p">);</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()],</span> 
                             <span class="n">hist_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">8</span><span class="p">),</span> 
                             <span class="n">kde_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                             <span class="n">label</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> vs target&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
        
    <span class="k">def</span> <span class="nf">f3</span><span class="p">():</span> 
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>  <span class="n">hist_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;missing (</span><span class="si">%d</span><span class="s2"> values)&quot;</span><span class="o">%</span><span class="k">n</span>)
        <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="o">~</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>  <span class="n">hist_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ok (</span><span class="si">%d</span><span class="s2"> values)&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">-</span><span class="n">n</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;distribution of target wrt </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="k">col</span>)
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        
    <span class="n">mlutils</span><span class="o">.</span><span class="n">figures_grid</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">k</span><span class="p">[</span><span class="n">k</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">plot_missing</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_0.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_0.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_1.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_1.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_2.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_2.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_3.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_3.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_4.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_4.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_5.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_5.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_6.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_6.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_7.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_7.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_8.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_8.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_9.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_9.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_10.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_10.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_11.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_11.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_12.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_12.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_13.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_13.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_14.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_14.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_15.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_15.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_16.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_16.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_17.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_17.png" />
<img alt="../_images/NOTES 04.02 - DATA CLEANING_9_18.png" src="../_images/NOTES 04.02 - DATA CLEANING_9_18.png" />
</div>
</div>
</div>
<div class="section" id="common-sense">
<h3>common sense<a class="headerlink" href="#common-sense" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>too many missing data in <strong>Alley</strong>. Information might only help non-missing items with little impact on</p></li>
<li><p>missing data in <strong>Bsmt*</strong> seem all the same</p></li>
<li><p>missing data in <strong>Garage*</strong> sell all the same</p></li>
</ul>
</div>
</div>
<div class="section" id="for-continuous-variables">
<h2>For continuous variables<a class="headerlink" href="#for-continuous-variables" title="Permalink to this headline">¶</a></h2>
<div class="section" id="three-substitution-techniques">
<h3>Three substitution techniques<a class="headerlink" href="#three-substitution-techniques" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>by a fixed value (zero)</p></li>
<li><p>by a fixed value (the mean)</p></li>
<li><p>sampling from an equivalent normal (same mean and std)</p></li>
</ul>
<p><strong>First</strong> we create the different datasets:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dn</span></code>: original data only with numerical attributes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dl0</span></code>: substituting missing values with zero</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dlm</span></code>: substituting missing values with the mean</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dlr</span></code>: substituting missing values with an equivalent normal (same mean and stdev)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">xdistplot</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">k</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">hist_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="o">.</span><span class="mi">8</span><span class="p">});</span>
    <span class="n">m</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">s</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">();</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">subs_policies</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
    <span class="n">mcol</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_missing&quot;</span><span class="o">%</span><span class="k">col</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="n">dn</span><span class="p">[[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dn</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">!=</span><span class="nb">object</span><span class="p">]]</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">dn</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="n">na_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">dl0</span> <span class="o">=</span> <span class="n">dn</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dlm</span> <span class="o">=</span> <span class="n">dn</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dlr</span> <span class="o">=</span> <span class="n">dn</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">dl0</span><span class="p">[</span><span class="n">mcol</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">dlm</span><span class="p">[</span><span class="n">mcol</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span> <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

    <span class="n">k</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">k</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">isna</span><span class="p">()))</span>
    <span class="n">dlr</span><span class="p">[</span><span class="n">mcol</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>

    <span class="n">f0</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">xdistplot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="s2">&quot;original&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">])</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">xdistplot</span><span class="p">(</span><span class="n">dl0</span><span class="p">[</span><span class="n">mcol</span><span class="p">],</span> <span class="s2">&quot;subs by zero&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">])</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">xdistplot</span><span class="p">(</span><span class="n">dlm</span><span class="p">[</span><span class="n">mcol</span><span class="p">],</span> <span class="s2">&quot;subs by mean&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">])</span>
    <span class="n">f3</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">xdistplot</span><span class="p">(</span><span class="n">dlr</span><span class="p">[</span><span class="n">mcol</span><span class="p">],</span> <span class="s2">&quot;subs by equivalent normal&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">])</span>

    <span class="n">mlutils</span><span class="o">.</span><span class="n">figures_grid</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">dn</span><span class="p">,</span> <span class="n">dl0</span><span class="p">,</span> <span class="n">dlm</span><span class="p">,</span> <span class="n">dlr</span><span class="p">,</span> <span class="n">na_idxs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">dn</span><span class="p">,</span> <span class="n">dl0</span><span class="p">,</span> <span class="n">dlm</span><span class="p">,</span> <span class="n">dlr</span><span class="p">,</span> <span class="n">na_idxs</span> <span class="o">=</span> <span class="n">subs_policies</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;LotFrontage&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1460, 34)
</pre></div>
</div>
<img alt="../_images/NOTES 04.02 - DATA CLEANING_18_1.png" src="../_images/NOTES 04.02 - DATA CLEANING_18_1.png" />
</div>
</div>
</div>
<div class="section" id="validation-workflow-for-repairing-missing-values-on-lotfrontage">
<h3>Validation workflow for repairing missing values on <strong>LotFrontage</strong><a class="headerlink" href="#validation-workflow-for-repairing-missing-values-on-lotfrontage" title="Permalink to this headline">¶</a></h3>
<p><strong>Which policy for repairing missing data is best?</strong></p>
<p>Short answer: <strong>we do not know</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <strong>we must seek evidence</strong></p>
<p>We will now integrate them in an ML workflow, creating predictive models and seeking for evidence if models improve or not when using different policies for repairing missing data.</p>
<p>We train a lot of models (resampling training data) with each dataset and then run a classical hypothesis test on model performance:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(e_1\)</span>: control group, models trained without <strong>LotFrontage</strong></p></li>
<li><p><span class="math notranslate nohighlight">\(e_2\)</span>: population group, models trained with <strong>LotFrontage</strong> with fillna=0</p></li>
</ul>
<p>Our null hypothesis (there is no effect in using the new variable):</p>
<div class="math notranslate nohighlight">
\[H_0: \mu_{e_1}-\mu_{e_2}=0 \Rightarrow \mu_{e_1-e_2}=0\]</div>
<p>Our test hypothesis (including fillna=0 improves models):</p>
<div class="math notranslate nohighlight">
\[H_1: \mu_{e_1}-\mu_{e_2}&lt;0 \Rightarrow \mu_{e_1-e_2}&lt;0\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">ShuffleSplit</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">make_scorer</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">ttest_ind</span>

<span class="k">def</span> <span class="nf">getXY</span> <span class="p">(</span><span class="n">dn</span><span class="p">):</span>
    <span class="n">xcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dn</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">i</span><span class="o">!=</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">dn</span><span class="p">[</span><span class="n">xcols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">dn</span><span class="o">.</span><span class="n">SalePrice</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xcols</span>

<span class="k">def</span> <span class="nf">experiment</span><span class="p">(</span><span class="n">dn</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=.</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">getXY</span><span class="p">(</span><span class="n">dn</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">ShuffleSplit</span><span class="p">(</span><span class="n">n_models</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">),</span> 
                        <span class="n">scoring</span><span class="o">=</span><span class="n">make_scorer</span><span class="p">(</span><span class="n">mean_absolute_error</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">r</span>

<span class="k">def</span> <span class="nf">HTest</span><span class="p">(</span><span class="n">ref_dataset</span><span class="p">,</span> <span class="n">h_datasets</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">experiment</span><span class="o">=</span><span class="n">experiment</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">estimator</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">re</span> <span class="o">=</span> <span class="p">[</span><span class="n">experiment</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">([</span><span class="n">ref_dataset</span><span class="p">]</span><span class="o">+</span><span class="n">h_datasets</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">re</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">r</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">dl0</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MSSubClass</th>
      <th>LotArea</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>BsmtFinSF1</th>
      <th>BsmtFinSF2</th>
      <th>BsmtUnfSF</th>
      <th>TotalBsmtSF</th>
      <th>...</th>
      <th>OpenPorchSF</th>
      <th>EnclosedPorch</th>
      <th>3SsnPorch</th>
      <th>ScreenPorch</th>
      <th>PoolArea</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SalePrice</th>
      <th>LotFrontage_missing</th>
    </tr>
    <tr>
      <th>Id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>60</td>
      <td>8450</td>
      <td>7</td>
      <td>5</td>
      <td>2003</td>
      <td>2003</td>
      <td>706</td>
      <td>0</td>
      <td>150</td>
      <td>856</td>
      <td>...</td>
      <td>61</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>2008</td>
      <td>208500</td>
      <td>65.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
      <td>9600</td>
      <td>6</td>
      <td>8</td>
      <td>1976</td>
      <td>1976</td>
      <td>978</td>
      <td>0</td>
      <td>284</td>
      <td>1262</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>2007</td>
      <td>181500</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>60</td>
      <td>11250</td>
      <td>7</td>
      <td>5</td>
      <td>2001</td>
      <td>2002</td>
      <td>486</td>
      <td>0</td>
      <td>434</td>
      <td>920</td>
      <td>...</td>
      <td>42</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>2008</td>
      <td>223500</td>
      <td>68.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>70</td>
      <td>9550</td>
      <td>7</td>
      <td>5</td>
      <td>1915</td>
      <td>1970</td>
      <td>216</td>
      <td>0</td>
      <td>540</td>
      <td>756</td>
      <td>...</td>
      <td>35</td>
      <td>272</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>2006</td>
      <td>140000</td>
      <td>60.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>60</td>
      <td>14260</td>
      <td>8</td>
      <td>5</td>
      <td>2000</td>
      <td>2000</td>
      <td>655</td>
      <td>0</td>
      <td>490</td>
      <td>1145</td>
      <td>...</td>
      <td>84</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>12</td>
      <td>2008</td>
      <td>250000</td>
      <td>84.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 35 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">HTest</span><span class="p">(</span><span class="n">dn</span><span class="p">,</span> <span class="p">[</span><span class="n">dl0</span><span class="p">,</span> <span class="n">dlm</span><span class="p">,</span> <span class="n">dlr</span><span class="p">],</span> <span class="n">n_models</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100% (4 of 4) |##########################| Elapsed Time: 0:00:22 Time:  0:00:22
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ttest_indResult(statistic=0.7557691502516851, pvalue=0.4516003896675306)
Ttest_indResult(statistic=-1.4073818287584146, pvalue=0.1624780543324849)
Ttest_indResult(statistic=-0.38678169914375066, pvalue=0.6997564158414822)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">HTest</span><span class="p">(</span><span class="n">dn</span><span class="p">,</span> <span class="p">[</span><span class="n">dl0</span><span class="p">,</span> <span class="n">dlm</span><span class="p">,</span> <span class="n">dlr</span><span class="p">],</span> <span class="n">n_models</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100% (4 of 4) |##########################| Elapsed Time: 0:00:22 Time:  0:00:22
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ttest_indResult(statistic=-0.2674687679580992, pvalue=0.7896703521077283)
Ttest_indResult(statistic=0.07436389268867344, pvalue=0.9408724204351284)
Ttest_indResult(statistic=1.1275786355848136, pvalue=0.26225106743094523)
</pre></div>
</div>
</div>
</div>
<p>No <span class="math notranslate nohighlight">\(p\)</span> value is really significative so the different substitution policies do no help improve overall in this simplified setting. More over, repeated experiments show to evidence of any approach better than others (always better <span class="math notranslate nohighlight">\(p\)</span> value)</p>
<p>Some models provide us with a measure of <strong>feature importance</strong>. Observe the behaviour of the most important variables in the scatter matrix plot of previous notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xcols</span> <span class="o">=</span> <span class="n">getXY</span><span class="p">(</span><span class="n">dlr</span><span class="p">)</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;est1&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xcols</span><span class="p">)),</span> <span class="n">xcols</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/NOTES 04.02 - DATA CLEANING_26_0.png" src="../_images/NOTES 04.02 - DATA CLEANING_26_0.png" />
</div>
</div>
<p>so somehow it is understandable that providing values for this missing variable does not have so much impact.</p>
<p>We could try to see <strong>ONLY</strong> how records with <strong>THIS</strong> missing data behave. Observe that <code class="docutils literal notranslate"><span class="pre">na_idxs</span></code> marks which rows contain <code class="docutils literal notranslate"><span class="pre">na</span></code> values so that they are used to measure validation performance.</p>
<p>There is still no clear evidence that any filling strategy for missing values  is better than other.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">na_cross_val_score</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="p">,</span> <span class="n">val_idxs</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tr_idxs</span><span class="p">,</span> <span class="n">ts_idxs</span> <span class="ow">in</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
        <span class="n">tr_idxs</span><span class="p">,</span> <span class="n">ts_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">tr_idxs</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">ts_idxs</span><span class="p">]</span>
        <span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">tr_idxs</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">tr_idxs</span><span class="p">])</span>
        <span class="n">valts_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ts_idxs</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">val_idxs</span><span class="p">]]</span>
        <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scoring</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">valts_idxs</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">valts_idxs</span><span class="p">]))</span>    
    <span class="k">return</span> <span class="n">r</span>


<span class="k">def</span> <span class="nf">na_experiment</span><span class="p">(</span><span class="n">dn</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">na_idxs</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=.</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">getXY</span><span class="p">(</span><span class="n">dn</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">na_cross_val_score</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">ShuffleSplit</span><span class="p">(</span><span class="n">n_models</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">),</span> 
                        <span class="n">scoring</span><span class="o">=</span><span class="n">make_scorer</span><span class="p">(</span><span class="n">mean_absolute_error</span><span class="p">),</span> <span class="n">val_idxs</span><span class="o">=</span><span class="n">na_idxs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">HTest</span><span class="p">(</span><span class="n">dn</span><span class="p">,</span> <span class="p">[</span><span class="n">dl0</span><span class="p">,</span> <span class="n">dlm</span><span class="p">,</span> <span class="n">dlr</span><span class="p">],</span> <span class="n">experiment</span><span class="o">=</span><span class="n">na_experiment</span><span class="p">,</span> <span class="n">na_idxs</span><span class="o">=</span><span class="n">na_idxs</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100% (4 of 4) |##########################| Elapsed Time: 0:00:11 Time:  0:00:11
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ttest_indResult(statistic=-0.5737783622358789, pvalue=0.5674323034918392)
Ttest_indResult(statistic=-0.9266853946811004, pvalue=0.3563664656955138)
Ttest_indResult(statistic=1.871355121426504, pvalue=0.06427879742818265)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">HTest</span><span class="p">(</span><span class="n">dn</span><span class="p">,</span> <span class="p">[</span><span class="n">dl0</span><span class="p">,</span> <span class="n">dlm</span><span class="p">,</span> <span class="n">dlr</span><span class="p">],</span> <span class="n">experiment</span><span class="o">=</span><span class="n">na_experiment</span><span class="p">,</span> <span class="n">na_idxs</span><span class="o">=</span><span class="n">na_idxs</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100% (4 of 4) |##########################| Elapsed Time: 0:00:11 Time:  0:00:11
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ttest_indResult(statistic=-0.8579704279579935, pvalue=0.3930022714114304)
Ttest_indResult(statistic=-0.4420684947642289, pvalue=0.6594136691363447)
Ttest_indResult(statistic=1.163369779223683, pvalue=0.24750430665847803)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="for-categorical-features">
<h2>For categorical features<a class="headerlink" href="#for-categorical-features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>we must convert them to numerical</p>
<ul>
<li><p>if categories are <strong>ordered</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span> convert to positive integer</p></li>
<li><p>otherwise <span class="math notranslate nohighlight">\(\rightarrow\)</span> convert to one hot</p></li>
</ul>
</li>
<li><p>we must decide on missing values:</p>
<ul>
<li><p>remove row or column</p></li>
<li><p>assign an existing value</p></li>
<li><p>assign a new value</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">col</span> <span class="o">=</span> <span class="s2">&quot;GarageFinish&quot;</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;missing&quot;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()))</span>
<span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>missing 81
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unf    605
RFn    422
Fin    352
Name: GarageFinish, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">to_onehot</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">values</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">replace_column_with_onehot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;column must have no NaN values&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                      <span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">to_onehot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span> <span class="n">index</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">del</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">r</span>
</pre></div>
</div>
</div>
</div>
<p>observe <strong>onehot</strong> encoding</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">d</span><span class="p">[[</span><span class="n">col</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GarageFinish</th>
    </tr>
    <tr>
      <th>Id</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>RFn</td>
    </tr>
    <tr>
      <th>2</th>
      <td>RFn</td>
    </tr>
    <tr>
      <th>3</th>
      <td>RFn</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Unf</td>
    </tr>
    <tr>
      <th>5</th>
      <td>RFn</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Unf</td>
    </tr>
    <tr>
      <th>7</th>
      <td>RFn</td>
    </tr>
    <tr>
      <th>8</th>
      <td>RFn</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Unf</td>
    </tr>
    <tr>
      <th>10</th>
      <td>RFn</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">replace_column_with_onehot</span><span class="p">(</span><span class="n">d</span><span class="p">[[</span><span class="n">col</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GarageFinish_Fin</th>
      <th>GarageFinish_RFn</th>
      <th>GarageFinish_Unf</th>
    </tr>
    <tr>
      <th>Id</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>we now create a onehot encoding for each case:</p>
<ul class="simple">
<li><p>create a separate value for missing data</p></li>
<li><p>set missing data to an existing category. In this case we will set it to the closest category distribution wrt the target variable according the plots above</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">rm1</span> <span class="o">=</span> <span class="n">replace_column_with_onehot</span><span class="p">(</span><span class="n">d</span><span class="p">[[</span><span class="n">col</span><span class="p">]]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;missing&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">col</span><span class="p">)</span>
<span class="n">rm2</span> <span class="o">=</span> <span class="n">replace_column_with_onehot</span><span class="p">(</span><span class="n">d</span><span class="p">[[</span><span class="n">col</span><span class="p">]]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;Unf&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">col</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">rm1</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GarageFinish_Fin</th>
      <th>GarageFinish_RFn</th>
      <th>GarageFinish_Unf</th>
      <th>GarageFinish_missing</th>
    </tr>
    <tr>
      <th>Id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">rm2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GarageFinish_Fin</th>
      <th>GarageFinish_RFn</th>
      <th>GarageFinish_Unf</th>
    </tr>
    <tr>
      <th>Id</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">dm1</span> <span class="o">=</span> <span class="n">dn</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rm1</span><span class="p">)</span>
<span class="n">dm2</span> <span class="o">=</span> <span class="n">dn</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rm2</span><span class="p">)</span>
<span class="n">dm1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dm2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((1460, 38), (1460, 37))
</pre></div>
</div>
</div>
</div>
<p>again, do hypothesis testing to seek for evidence for improvements for any of the methods</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">HTest</span><span class="p">(</span><span class="n">dn</span><span class="p">,</span> <span class="p">[</span><span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">],</span> <span class="n">experiment</span><span class="o">=</span><span class="n">experiment</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100% (3 of 3) |##########################| Elapsed Time: 0:00:16 Time:  0:00:16
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ttest_indResult(statistic=0.20678743729250315, pvalue=0.8366049088865752)
Ttest_indResult(statistic=2.3425479620420515, pvalue=0.021174779349792214)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">na_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">HTest</span><span class="p">(</span><span class="n">dn</span><span class="p">,</span> <span class="p">[</span><span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">],</span> <span class="n">experiment</span><span class="o">=</span><span class="n">na_experiment</span><span class="p">,</span> <span class="n">na_idxs</span><span class="o">=</span><span class="n">na_idxs</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100% (3 of 3) |##########################| Elapsed Time: 0:00:08 Time:  0:00:08
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ttest_indResult(statistic=0.27587786417000965, pvalue=0.7832227828661817)
Ttest_indResult(statistic=1.2880901521198285, pvalue=0.2007476881215529)
</pre></div>
</div>
</div>
</div>
<p>Again, no <span class="math notranslate nohighlight">\(p\)</span> value is sufficiently significative to provide evidence for improved classification alone. However, approach number 2 (substituting missing data with <strong>Unf</strong>) does seem to consistently get better <span class="math notranslate nohighlight">\(p\)</span> value and, thus, more chance to improve performance when combined with other data cleaning choices.</p>
<p>Observe also how the <strong>missing</strong> category dilutes the importance of <strong>Unf</strong> after other variables are taken out.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">dk</span> <span class="o">=</span> <span class="n">dm2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">dk</span> <span class="o">=</span> <span class="n">dk</span><span class="p">[[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dm2</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;OverallQual&quot;</span><span class="p">,</span> <span class="s2">&quot;GarageCars&quot;</span><span class="p">,</span> <span class="s2">&quot;GrLivArea&quot;</span><span class="p">,</span> 
                                             <span class="s2">&quot;GarageArea&quot;</span><span class="p">,</span> <span class="s2">&quot;YearBuilt&quot;</span><span class="p">,</span> <span class="s2">&quot;TotalBsmtSF&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;1stFlrSF&quot;</span><span class="p">,</span> <span class="s2">&quot;2ndFlrSF&quot;</span><span class="p">,</span> <span class="s2">&quot;FullBath&quot;</span><span class="p">]]]</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xcols</span> <span class="o">=</span> <span class="n">getXY</span><span class="p">(</span><span class="n">dk</span><span class="p">)</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;est1&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xcols</span><span class="p">)),</span> <span class="n">xcols</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/NOTES 04.02 - DATA CLEANING_47_0.png" src="../_images/NOTES 04.02 - DATA CLEANING_47_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## KEEPOUTPUT</span>
<span class="n">dk</span> <span class="o">=</span> <span class="n">dm1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">dk</span> <span class="o">=</span> <span class="n">dk</span><span class="p">[[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dm1</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;OverallQual&quot;</span><span class="p">,</span> <span class="s2">&quot;GarageCars&quot;</span><span class="p">,</span> <span class="s2">&quot;GrLivArea&quot;</span><span class="p">,</span> 
                                             <span class="s2">&quot;GarageArea&quot;</span><span class="p">,</span> <span class="s2">&quot;YearBuilt&quot;</span><span class="p">,</span> <span class="s2">&quot;TotalBsmtSF&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;1stFlrSF&quot;</span><span class="p">,</span> <span class="s2">&quot;2ndFlrSF&quot;</span><span class="p">,</span> <span class="s2">&quot;FullBath&quot;</span><span class="p">]]]</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xcols</span> <span class="o">=</span> <span class="n">getXY</span><span class="p">(</span><span class="n">dk</span><span class="p">)</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;est1&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xcols</span><span class="p">)),</span> <span class="n">xcols</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/NOTES 04.02 - DATA CLEANING_48_0.png" src="../_images/NOTES 04.02 - DATA CLEANING_48_0.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "p38"
        },
        kernelOptions: {
            kernelName: "p38",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'p38'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="NOTES%2004.01%20-%20DATA%20EXPLORATION.html" title="previous page">04.01 - DATA EXPLORATION</a>
    <a class='right-next' id="next-link" href="NOTES%2004.03%20-%20SIMPLE%20HYPOTHESIS%20TESTING.html" title="next page">04.03 - HYPOTHESIS TESTING</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Raúl Ramos / Universidad de Antioquia<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-43235448-4', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>